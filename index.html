<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>서초구 집계구 및 행정구역 지도</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <style>
        body {
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        #map {
            height: 100vh;
            width: 100%;
        }
        
        .control-panel {
            position: absolute;
            top: 10px;
            right: 10px;
            background: white;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            z-index: 1000;
            min-width: 200px;
        }
        
        .control-panel h3 {
            margin: 0 0 10px 0;
            color: #333;
            font-size: 16px;
        }
        
        .layer-control {
            margin-bottom: 10px;
        }
        
        .layer-control label {
            display: flex;
            align-items: center;
            cursor: pointer;
            font-size: 14px;
        }
        
        .layer-control input[type="checkbox"] {
            margin-right: 8px;
        }
        
        .info-panel {
            position: absolute;
            bottom: 10px;
            left: 10px;
            background: white;
            padding: 10px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            z-index: 1000;
            font-size: 12px;
            color: #666;
        }
        
        .map-toggle {
            position: absolute;
            bottom: 10px;
            right: 10px;
            background: white;
            padding: 10px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            z-index: 1000;
            font-size: 12px;
        }
        
        .map-toggle button {
            margin: 2px;
            padding: 5px 10px;
            border: 1px solid #ddd;
            background: white;
            cursor: pointer;
            border-radius: 4px;
            font-size: 11px;
        }
        
        .map-toggle button.active {
            background: #007bff;
            color: white;
            border-color: #007bff;
        }
        
        .map-toggle button:hover {
            background: #f0f0f0;
        }
        
        .map-toggle button.active:hover {
            background: #0056b3;
        }
        
        .loading {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(255, 255, 255, 0.9);
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            z-index: 2000;
            text-align: center;
            font-size: 14px;
            color: #333;
        }
    </style>
</head>
<body>
    <div id="map"></div>
    
    <div class="control-panel">
        <h3>레이어 제어</h3>
        <div class="layer-control">
            <label>
                <input type="checkbox" id="집계구Layer" checked>
                집계구
            </label>
        </div>
        <div class="layer-control">
            <label>
                <input type="checkbox" id="행정구역Layer" checked>
                행정구역
            </label>
        </div>
    </div>
    
    <div class="info-panel">
        <div>📍 서초구 집계구 및 행정구역 지도</div>
        <div>💡 체크박스를 클릭하여 레이어를 토글할 수 있습니다</div>
    </div>
    
    <div class="map-toggle">
        <div style="margin-bottom: 5px; font-weight: bold;">🗺️ 지도 스타일</div>
        <button id="defaultMap" class="active">기본 지도</button>
        <button id="cartoMap">간소화 지도</button>
    </div>
    
    <div class="loading" id="loading">
        <div>🔄 지도 데이터를 로딩 중...</div>
    </div>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script>
        // 지도 초기화 (서초구 중심)
        const map = L.map('map').setView([37.4947, 127.0276], 13);
        
        // 지도 타일 레이어 정의
        const defaultMapLayer = L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '© OpenStreetMap contributors'
        });
        
        const cartoMapLayer = L.tileLayer('https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png', {
            attribution: '© OpenStreetMap contributors © CARTO'
        });
        
        // 기본 지도 레이어 추가
        defaultMapLayer.addTo(map);
        
        // 레이어 그룹 생성
        const 집계구Layer = L.layerGroup();
        const 행정구역Layer = L.layerGroup();
        
        // 스타일 정의
        const 집계구Style = {
            color: '#ff6b6b',
            weight: 1,
            opacity: 0.8,
            fillOpacity: 0.3
        };
        
        const 행정구역Style = {
            color: '#4ecdc4',
            weight: 2,
            opacity: 0.9,
            fillOpacity: 0.2
        };
        
        // 로드된 레이어 추적
        let loadedLayers = [];
        
        // 데이터 로드 함수
        async function loadData() {
            try {
                console.log('데이터 로드 시작...');
                
                // 집계구 데이터 로드
                console.log('집계구 데이터 로드 시도...');
                const 집계구Response = await fetch('./집계구.geojson');
                if (집계구Response.ok) {
                    const 집계구Data = await 집계구Response.json();
                    console.log('집계구 데이터 로드 성공:', 집계구Data.features.length, '개 레코드');
                    L.geoJSON(집계구Data, {
                        style: 집계구Style,
                        onEachFeature: function(feature, layer) {
                            // 팝업 정보 추가 (집계구)
                            const props = feature.properties;
                            let popupContent = `<b>집계구</b> : ${props.TOT_REG_CD || ''}<br>`;
                            popupContent += `${props.ADM_NM || ''}(${props.ADM_CD || ''})`;
                            layer.bindPopup(popupContent);
                        }
                    }).addTo(집계구Layer);
                    loadedLayers.push(집계구Layer);
                } else {
                    console.warn('집계구.geojson 파일을 찾을 수 없습니다. 상태:', 집계구Response.status);
                }
                
                // 행정구역 데이터 로드
                console.log('행정구역 데이터 로드 시도...');
                const 행정구역Response = await fetch('./행정구역.geojson');
                if (행정구역Response.ok) {
                    const 행정구역Data = await 행정구역Response.json();
                    console.log('행정구역 데이터 로드 성공:', 행정구역Data.features.length, '개 레코드');
                    L.geoJSON(행정구역Data, {
                        style: 행정구역Style,
                        onEachFeature: function(feature, layer) {
                            // 팝업 정보 추가 (행정구역)
                            const props = feature.properties;
                            let popupContent = `<b>행정구역</b><br>`;
                            popupContent += `${props.SIDO_NM || ''} ${props.SIGUNGU_NM || ''} ${props.ADM_NM || ''}(${props.ADM_CD || ''})`;
                            layer.bindPopup(popupContent);
                        }
                    }).addTo(행정구역Layer);
                    loadedLayers.push(행정구역Layer);
                } else {
                    console.warn('행정구역.geojson 파일을 찾을 수 없습니다. 상태:', 행정구역Response.status);
                }
                
                // 로드된 레이어들을 지도에 추가
                loadedLayers.forEach(layer => {
                    map.addLayer(layer);
                });
                
                // 지도 범위 자동 조정
                if (loadedLayers.length > 0) {
                    const group = new L.featureGroup(loadedLayers);
                    map.fitBounds(group.getBounds().pad(0.1));
                }
                
                // 로딩 화면 숨기기
                document.getElementById('loading').style.display = 'none';
                
                console.log('지도 로드 완료. 로드된 레이어 수:', loadedLayers.length);
                
            } catch (error) {
                console.error('데이터 로드 중 오류 발생:', error);
                console.error('오류 상세:', error.message);
                document.getElementById('loading').style.display = 'none';
            }
        }
        
        // 레이어 제어 이벤트
        document.getElementById('집계구Layer').addEventListener('change', function() {
            if (this.checked) {
                집계구Layer.addTo(map);
            } else {
                map.removeLayer(집계구Layer);
            }
        });
        
        document.getElementById('행정구역Layer').addEventListener('change', function() {
            if (this.checked) {
                행정구역Layer.addTo(map);
            } else {
                map.removeLayer(행정구역Layer);
            }
        });
        
        // 지도 스타일 토글 이벤트 리스너
        document.getElementById('defaultMap').addEventListener('click', function() {
            // 기본 지도로 전환
            map.removeLayer(cartoMapLayer);
            map.addLayer(defaultMapLayer);
            
            // 버튼 상태 업데이트
            document.getElementById('defaultMap').classList.add('active');
            document.getElementById('cartoMap').classList.remove('active');
        });
        
        document.getElementById('cartoMap').addEventListener('click', function() {
            // 간소화 지도로 전환
            map.removeLayer(defaultMapLayer);
            map.addLayer(cartoMapLayer);
            
            // 버튼 상태 업데이트
            document.getElementById('cartoMap').classList.add('active');
            document.getElementById('defaultMap').classList.remove('active');
        });
        
        // 데이터 로드 시작
        loadData();
    </script>
</body>
</html>
