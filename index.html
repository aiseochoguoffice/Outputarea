<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>서초구 집계구 및 행정구역 지도</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <style>
        body {
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        #map {
            height: 100vh;
            width: 100%;
        }
        
        .control-panel {
            position: absolute;
            top: 10px;
            right: 10px;
            background: white;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            z-index: 1000;
            min-width: 200px;
        }
        
        .control-panel h3 {
            margin: 0 0 10px 0;
            color: #333;
            font-size: 16px;
        }
        
        .layer-control {
            margin-bottom: 10px;
        }
        
        .layer-control label {
            display: flex;
            align-items: center;
            cursor: pointer;
            font-size: 14px;
        }
        
        .layer-control input[type="checkbox"] {
            margin-right: 8px;
        }
        
        .info-panel {
            position: absolute;
            bottom: 10px;
            left: 10px;
            background: white;
            padding: 10px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            z-index: 1000;
            font-size: 12px;
            color: #666;
        }
    </style>
</head>
<body>
    <div id="map"></div>
    
    <div class="control-panel">
        <h3>레이어 제어</h3>
        <div class="layer-control">
            <label>
                <input type="checkbox" id="집계구Layer" checked>
                집계구
            </label>
        </div>
        <div class="layer-control">
            <label>
                <input type="checkbox" id="행정구역Layer" checked>
                행정구역
            </label>
        </div>
    </div>
    
    <div class="info-panel">
        <div>서초구 집계구 및 행정구역 지도</div>
        <div>마우스 오버로 상세 정보 확인</div>
    </div>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script>
        // 지도 초기화
        const map = L.map('map').setView([37.4947, 127.0276], 12);
        
        // OpenStreetMap 타일 레이어 추가
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '© OpenStreetMap contributors'
        }).addTo(map);
        
        // 레이어 그룹 생성
        const 집계구Layer = L.layerGroup();
        const 행정구역Layer = L.layerGroup();
        
        // 스타일 정의
        const 집계구Style = {
            color: '#ff6b6b',
            weight: 1,
            opacity: 0.8,
            fillOpacity: 0.3
        };
        
        const 행정구역Style = {
            color: '#4ecdc4',
            weight: 2,
            opacity: 0.9,
            fillOpacity: 0.2
        };
        
        // 로드된 레이어 추적
        let loadedLayers = [];
        
        // 데이터 로드 함수
        async function loadData() {
            try {
                // 집계구 데이터 로드
                const 집계구Response = await fetch('./집계구.geojson');
                if (집계구Response.ok) {
                    const 집계구Data = await 집계구Response.json();
                    console.log('집계구 데이터 로드 성공:', 집계구Data.features.length, '개 레코드');
                    L.geoJSON(집계구Data, {
                        style: 집계구Style,
                        onEachFeature: function(feature, layer) {
                            // 팝업 정보 추가 (집계구)
                            const props = feature.properties;
                            let popupContent = `<b>집계구</b> : ${props.TOT_REG_CD || ''}<br>`;
                            popupContent += `${props.ADM_NM || ''}(${props.ADM_CD || ''})`;
                            layer.bindPopup(popupContent);
                        }
                    }).addTo(집계구Layer);
                    loadedLayers.push(집계구Layer);
                } else {
                    console.warn('집계구.geojson 파일을 찾을 수 없습니다. 상태:', 집계구Response.status);
                }
                
                // 행정구역 데이터 로드
                const 행정구역Response = await fetch('./행정구역.geojson');
                if (행정구역Response.ok) {
                    const 행정구역Data = await 행정구역Response.json();
                    console.log('행정구역 데이터 로드 성공:', 행정구역Data.features.length, '개 레코드');
                    L.geoJSON(행정구역Data, {
                        style: 행정구역Style,
                        onEachFeature: function(feature, layer) {
                            // 팝업 정보 추가 (행정구역)
                            const props = feature.properties;
                            let popupContent = `<b>행정구역</b><br>`;
                            popupContent += `${props.SIDO_NM || ''} ${props.SIGUNGU_NM || ''} ${props.ADM_NM || ''}(${props.ADM_CD || ''})`;
                            layer.bindPopup(popupContent);
                        }
                    }).addTo(행정구역Layer);
                    loadedLayers.push(행정구역Layer);
                } else {
                    console.warn('행정구역.geojson 파일을 찾을 수 없습니다. 상태:', 행정구역Response.status);
                }
                
                // 초기 레이어 표시
                집계구Layer.addTo(map);
                행정구역Layer.addTo(map);
                
            } catch (error) {
                console.error('데이터 로드 중 오류 발생:', error);
            }
        }
        
        // 레이어 제어 이벤트
        document.getElementById('집계구Layer').addEventListener('change', function() {
            if (this.checked) {
                집계구Layer.addTo(map);
            } else {
                map.removeLayer(집계구Layer);
            }
        });
        
        document.getElementById('행정구역Layer').addEventListener('change', function() {
            if (this.checked) {
                행정구역Layer.addTo(map);
            } else {
                map.removeLayer(행정구역Layer);
            }
        });
        
        // 데이터 로드 시작
        loadData();
    </script>
</body>
</html>
